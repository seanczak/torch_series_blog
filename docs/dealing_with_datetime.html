---

title: Combatting the Datetime Blues in Python

keywords: fastai
sidebar: home_sidebar

summary: "Opinionated wrangling of datetime objects"
description: "Opinionated wrangling of datetime objects"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_dealing_with_datetime.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Motivation">Motivation<a class="anchor-link" href="#Motivation"> </a></h2><p>At some point in their careers, all data scientists have suffered from a case of what I like to call "The Datetime Blues."  They come when you least expect. You've worked hard to scrape data from somewhere or query it from some loosely maintained internal database and you feel ready to go. You're super excited to dig into the data, start making some visualizations, forming/testing hypotheses, and get some quick results back to your stakeholders about a project's scope.  However, after importing the data you realize its stored in one of the time formats that you're not 100% familiar with. Ok fine, a quick stackoverflow search and the dataset is ready...right?  Well, not exactly. You then realize that all your metadata is a different time format. Ok, a few more stackoverflow searches and you're up and running again.  "WHAT NO?! Why did this python package add an extra 56 minutes when converting from local time to UTC?!?"  Yes my friend, you have a case of the datetime blues.</p>
<p>Fortunately this only occurs every so often in my work. But it happens just frequently enough to be annoying and just infrequently enough that I forget all the stackoverflow insights I learned the last time I dealt with the problems.  Thus, for my own sake if not yours, I want to put in writing some of the little hiccups and solutions I've come across while working with datetime objects in python and pandas.  I'll probably be adding to this piece so please provide any feedback in the comments. :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Opinion:-&quot;Time-since-epoch&quot;-vs-&quot;Datetime&quot;">Opinion: "Time since epoch" vs "Datetime"<a class="anchor-link" href="#Opinion:-&quot;Time-since-epoch&quot;-vs-&quot;Datetime&quot;"> </a></h2><p>Before getting into the code, I would like to mention that, in my experience, a reasonable first step in any time series analysis project is to immediately convert everything into seconds (or milli-/microseconds) since epoch. (Note that by definition, epoch is: <code>00:00:00 UTC Jan 1, 1970</code>.) There are several reasons for this but the ones that I find most pertinent are as follows:</p>
<ul>
<li>an <code>int</code> object is much smaller than a <code>datetime</code> or a <code>str</code> object. This leads to all sorts of benefits such as smaller storage footprint, faster querying, simpler computation, etc.</li>
<li>epoch time is timezone independent by its nature. There is no need to ever track down a missing bit of timezone information because it's unclear if it's omission implies UTC or simply a lapse of documentation</li>
<li>if you work with machine learning models, they understand <code>int</code>s but not <code>datetime</code> objects</li>
</ul>
<p>Thus, I typically work with epoch time unless I have some reason to use/see the exact date and time (e.g. visualizations, sanity checks, etc).  However, it's not always clear on how to translate between epoch time and datetime.  To further complicate matters, there are some projects that may require multiple transformations back and forth between the two formats.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Working-with-single-timestamps">Working with single timestamps<a class="anchor-link" href="#Working-with-single-timestamps"> </a></h2><p>The following will work with converting back and forth between epoch time and datetime for single timestamps.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Initiating-a-timezone-aware-datetime">Initiating a timezone-aware <code>datetime</code><a class="anchor-link" href="#Initiating-a-timezone-aware-datetime"> </a></h3><p>Despite the above reasons, my human brain still understands datetimes better and, thus, when initiating a timestamp or datetime object (say, for the sake of toy demonstrations for a blog post), I typically start with a datetime representation. However, if I use a datetime object, it is important to make sure that it is "timezone-aware." One of the more ...ahem, enjoyable... aspects of working with datetimes in python is that there are multiple packages to choose from and they all have their own strengths, limitations, and strange nuisances to watch out for. For example, I use <code>datetime</code> as the main workhorse of my analysis but I use <code>pytz</code> to handle the timezone information of those <code>datetime</code> objects.  By way of example, let's initiate an unaware datetime object for <code>9/13/2019</code> at <code>8:10:25am</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">unaware_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unaware_dt:   &#39;</span><span class="p">,</span> <span class="n">unaware_dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>unaware_dt:    2019-09-13 08:10:25
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we can try and use the same function call to make a tz-aware datetime object by simply feeding a timezone into the <code>tzinfo</code> argument. But... why does the timezone correction piece read: <code>-04:56</code> instead of <code>-04:00</code>?! To be honest, I remember reading into it at some point and finding the answer too convoluted to care about. Thus, I've decided that the fast-build answer to this is simply: don't initiate tz-aware datetimes like this.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pytz</span>

<span class="n">nyc_tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="n">bad_aware_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">nyc_tz</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unaware_dt:   &#39;</span><span class="p">,</span> <span class="n">unaware_dt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad_aware_dt: &#39;</span><span class="p">,</span> <span class="n">bad_aware_dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>unaware_dt:    2019-09-13 08:10:25
bad_aware_dt:  2019-09-13 08:10:25-04:56
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So how do we initiate a tz-aware datetime object?  Well, one way to do this is to use <code>pytz</code>'s <code>localize</code> method.  Here you call <code>localize</code> on a <code>pytz</code> timezone object and pass in an unaware datetime object.  I've found this to be a reliable way to format a tz-aware datetime from scratch.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mk_aware</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)):</span> 
    <span class="k">return</span> <span class="n">tz</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

<span class="n">good_aware_dt</span> <span class="o">=</span> <span class="n">mk_aware</span><span class="p">(</span><span class="n">unaware_dt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unaware_dt:   &#39;</span><span class="p">,</span> <span class="n">unaware_dt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad_aware_dt: &#39;</span><span class="p">,</span> <span class="n">bad_aware_dt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;good_aware_dt:&#39;</span><span class="p">,</span> <span class="n">good_aware_dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>unaware_dt:    2019-09-13 08:10:25
bad_aware_dt:  2019-09-13 08:10:25-04:56
good_aware_dt: 2019-09-13 08:10:25-04:00
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And of course, if you have to choose a timezone and you didn't have a preference, I recommend using UTC. Which is done using the above function in the following way:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">utc_aware_dt</span> <span class="o">=</span> <span class="n">mk_aware</span><span class="p">(</span><span class="n">unaware_dt</span><span class="p">,</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unaware_dt:   &#39;</span><span class="p">,</span> <span class="n">unaware_dt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;utc_aware_dt: &#39;</span><span class="p">,</span> <span class="n">utc_aware_dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>unaware_dt:    2019-09-13 08:10:25
utc_aware_dt:  2019-09-13 08:10:25+00:00
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-a-datetime-object-to-epoch-time">Converting a datetime object to epoch time<a class="anchor-link" href="#Converting-a-datetime-object-to-epoch-time"> </a></h3><p>In order to convert a <code>datetime</code> object to epoch time. the <code>timestamp</code> method can be used along with the built in <code>int()</code> python function. However, this will always give the results in terms of seconds so if you're interested in milliseconds, simply multiply by 1000.  The only "gotcha" to mention here is that you need to provide a tz-aware <code>datetime</code> in order to ensure that the proper time is referenced.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">dt_to_s</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">dt_to_ms</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">dt_example</span> <span class="o">=</span> <span class="n">mk_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">tz</span><span class="o">=</span><span class="n">nyc_tz</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt_example</span><span class="p">)</span>
<span class="n">sec_epoch</span> <span class="o">=</span> <span class="n">dt_to_s</span><span class="p">(</span><span class="n">dt_example</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sec_epoch</span><span class="p">)</span>
<span class="n">msec_epoch</span> <span class="o">=</span> <span class="n">dt_to_ms</span><span class="p">(</span><span class="n">dt_example</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msec_epoch</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2019-09-13 08:10:25-04:00
1568376625
1568376625000
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-Epoch-time-back-to-Datetime">Converting Epoch time back to Datetime<a class="anchor-link" href="#Converting-Epoch-time-back-to-Datetime"> </a></h3><p>Again, the name of the game is making the datetime object tz-aware. Note that this is a naive timestamp but it has assumed the timezone to be the local one... so this is kind of dangerous since it gives the local time the timestamp refers to but doesn't tell you that it's doing that.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">back2dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">sec_epoch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">back2dt</span><span class="p">)</span>
<span class="n">back2dt</span> <span class="o">=</span> <span class="n">mk_aware</span><span class="p">(</span><span class="n">back2dt</span><span class="p">,</span><span class="n">tz</span> <span class="o">=</span> <span class="n">nyc_tz</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">back2dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2019-09-13 08:10:25
2019-09-13 08:10:25-04:00
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-tz-information">Converting tz information<a class="anchor-link" href="#Converting-tz-information"> </a></h3><p>I suggest not doing this while working with <code>datetime</code> objects.  The following shows that using the <code>replace</code> method for <code>datetime</code> objects has unpredictable behavior. The conversion from nyc to utc worked well but converting back did not. Again, I always work in epoch time in order to avoid this. (Note: apparently other packages like pendulum and django do not have this problem so feel free to explore those.)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">now_utc_dt</span> <span class="o">=</span> <span class="n">good_aware_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now_utc_dt</span><span class="p">)</span>
<span class="n">now_nyc_dt</span> <span class="o">=</span> <span class="n">now_utc_dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">nyc_tz</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now_nyc_dt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2019-09-13 08:10:25+00:00
2019-09-13 08:10:25-04:56
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-from-a-string">Converting from a string<a class="anchor-link" href="#Converting-from-a-string"> </a></h3><p>There are several ways to do this. But the one that I like to use is <code>dateutil.parser</code> which seems to do everything for me behind the scenes.  Yes, it's another datetime package in python (woohoo).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dateutil</span> <span class="k">import</span> <span class="n">parser</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;04/26/2020 8:10am&#39;</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="n">dt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>datetime.datetime(2020, 4, 26, 8, 10)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Working-with-datetime-in-pandas">Working with datetime in pandas<a class="anchor-link" href="#Working-with-datetime-in-pandas"> </a></h2><p>Typically, when working with time series data, it will come ina in tabular form.  Let's start by creating a dataframe of 10 minutes of epoch times and some fake data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># make utc aware datetimes for start and end (10 minutes later)</span>
<span class="n">dt_start_time</span> <span class="o">=</span> <span class="n">mk_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
<span class="n">dt_end_time</span> <span class="o">=</span> <span class="n">dt_start_time</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># convert to epoch time</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">dt_to_s</span><span class="p">(</span><span class="n">dt_start_time</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">dt_to_s</span><span class="p">(</span><span class="n">dt_end_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;From start: </span><span class="si">{start_time}</span><span class="s1"> to end: </span><span class="si">{end_time}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># create fake data and time array</span>
<span class="n">time_sec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">))</span>
<span class="n">fake_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_sec</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># store in dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fake_data</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">time_sec</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span><span class="s1">&#39;col2&#39;</span><span class="p">])</span>

<span class="c1"># reformat dataframe so it&#39;s presentable</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;time_sec&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>From start: 1568376625 to end: 1568377225
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_sec</th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1568376625</td>
      <td>-1.347006</td>
      <td>-1.672383</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1568376626</td>
      <td>-0.259848</td>
      <td>1.248307</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1568376627</td>
      <td>-0.964758</td>
      <td>-0.412814</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1568376628</td>
      <td>0.066694</td>
      <td>-0.014838</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1568376629</td>
      <td>0.019538</td>
      <td>-0.154513</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-Epoch-time-to-datetime">Converting Epoch time to datetime<a class="anchor-link" href="#Converting-Epoch-time-to-datetime"> </a></h3><p>Pandas has a built in function <code>pd.to_datetime()</code> which accepts a numeric column and outputs a datetime column.  Note that we've specified utc as our desired timezone in order to avoid future confusion.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;utc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time_sec</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_sec</th>
      <th>col1</th>
      <th>col2</th>
      <th>utc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1568376625</td>
      <td>-1.347006</td>
      <td>-1.672383</td>
      <td>2019-09-13 12:10:25+00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1568376626</td>
      <td>-0.259848</td>
      <td>1.248307</td>
      <td>2019-09-13 12:10:26+00:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1568376627</td>
      <td>-0.964758</td>
      <td>-0.412814</td>
      <td>2019-09-13 12:10:27+00:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1568376628</td>
      <td>0.066694</td>
      <td>-0.014838</td>
      <td>2019-09-13 12:10:28+00:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1568376629</td>
      <td>0.019538</td>
      <td>-0.154513</td>
      <td>2019-09-13 12:10:29+00:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-between-timezones">Converting between timezones<a class="anchor-link" href="#Converting-between-timezones"> </a></h3><p>Note that pandas does not suffer from the same issue that datetime does. It is able to repeatably switch between timezones.  Note that in order to operate on the datetime column, we need to access it by using the <code>dt</code> accessor.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nyc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;utc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">nyc_tz</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_sec</th>
      <th>col1</th>
      <th>col2</th>
      <th>utc</th>
      <th>nyc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1568376625</td>
      <td>-1.347006</td>
      <td>-1.672383</td>
      <td>2019-09-13 12:10:25+00:00</td>
      <td>2019-09-13 08:10:25-04:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1568376626</td>
      <td>-0.259848</td>
      <td>1.248307</td>
      <td>2019-09-13 12:10:26+00:00</td>
      <td>2019-09-13 08:10:26-04:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1568376627</td>
      <td>-0.964758</td>
      <td>-0.412814</td>
      <td>2019-09-13 12:10:27+00:00</td>
      <td>2019-09-13 08:10:27-04:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1568376628</td>
      <td>0.066694</td>
      <td>-0.014838</td>
      <td>2019-09-13 12:10:28+00:00</td>
      <td>2019-09-13 08:10:28-04:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1568376629</td>
      <td>0.019538</td>
      <td>-0.154513</td>
      <td>2019-09-13 12:10:29+00:00</td>
      <td>2019-09-13 08:10:29-04:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Converting-from-datetime-Column-to-Epoch-Time-Column">Converting from <code>datetime</code> Column to Epoch Time Column<a class="anchor-link" href="#Converting-from-datetime-Column-to-Epoch-Time-Column"> </a></h3><p>So this one is a bit tricky.  The primary function that converts from <code>datetime</code> to epoch time is just to tell pandas that you want to change the type of the column to <code>int</code>.  However, this returns nanoseconds so we need to then account for that by dividing by 1e-9 (which in turn pandas converts to a <code>float</code> and then displays with scientific notation). Thus, if you're ultimate goal is a column with type <code>int</code> of seconds, you would need to cast it back to <code>int</code> again after this rescaling.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;back2sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">nyc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_sec</th>
      <th>col1</th>
      <th>col2</th>
      <th>utc</th>
      <th>nyc</th>
      <th>back2sec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1568376625</td>
      <td>-1.347006</td>
      <td>-1.672383</td>
      <td>2019-09-13 12:10:25+00:00</td>
      <td>2019-09-13 08:10:25-04:00</td>
      <td>1.568377e+09</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1568376626</td>
      <td>-0.259848</td>
      <td>1.248307</td>
      <td>2019-09-13 12:10:26+00:00</td>
      <td>2019-09-13 08:10:26-04:00</td>
      <td>1.568377e+09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1568376627</td>
      <td>-0.964758</td>
      <td>-0.412814</td>
      <td>2019-09-13 12:10:27+00:00</td>
      <td>2019-09-13 08:10:27-04:00</td>
      <td>1.568377e+09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1568376628</td>
      <td>0.066694</td>
      <td>-0.014838</td>
      <td>2019-09-13 12:10:28+00:00</td>
      <td>2019-09-13 08:10:28-04:00</td>
      <td>1.568377e+09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1568376629</td>
      <td>0.019538</td>
      <td>-0.154513</td>
      <td>2019-09-13 12:10:29+00:00</td>
      <td>2019-09-13 08:10:29-04:00</td>
      <td>1.568377e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I created this function just in case I was interested in converting the whole column to the nearest <code>int</code>.  I demonstrate that pandas is able to properly handle different timezones by creating two new columns with the function starting from two different timezone columns (utc and nyc).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">series_to_epoch</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="n">units</span> <span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">return_int</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># choose conversion factor</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">conversion</span> <span class="o">=</span> <span class="mf">1e9</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="n">conversion</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span><span class="s1">&#39;us&#39;</span><span class="p">:</span> <span class="n">conversion</span> <span class="o">=</span> <span class="mf">1e3</span>
    
    <span class="k">if</span> <span class="n">return_int</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">/</span><span class="n">conversion</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># returns floats (scientific notation)</span>
        <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">/</span><span class="n">conversion</span>
    
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;back2sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_to_epoch</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nyc</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;back2ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_to_epoch</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_sec</th>
      <th>col1</th>
      <th>col2</th>
      <th>utc</th>
      <th>nyc</th>
      <th>back2sec</th>
      <th>back2ms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1568376625</td>
      <td>-1.347006</td>
      <td>-1.672383</td>
      <td>2019-09-13 12:10:25+00:00</td>
      <td>2019-09-13 08:10:25-04:00</td>
      <td>1568376625</td>
      <td>1568376625000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1568376626</td>
      <td>-0.259848</td>
      <td>1.248307</td>
      <td>2019-09-13 12:10:26+00:00</td>
      <td>2019-09-13 08:10:26-04:00</td>
      <td>1568376626</td>
      <td>1568376626000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1568376627</td>
      <td>-0.964758</td>
      <td>-0.412814</td>
      <td>2019-09-13 12:10:27+00:00</td>
      <td>2019-09-13 08:10:27-04:00</td>
      <td>1568376627</td>
      <td>1568376627000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1568376628</td>
      <td>0.066694</td>
      <td>-0.014838</td>
      <td>2019-09-13 12:10:28+00:00</td>
      <td>2019-09-13 08:10:28-04:00</td>
      <td>1568376628</td>
      <td>1568376628000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1568376629</td>
      <td>0.019538</td>
      <td>-0.154513</td>
      <td>2019-09-13 12:10:29+00:00</td>
      <td>2019-09-13 08:10:29-04:00</td>
      <td>1568376629</td>
      <td>1568376629000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

